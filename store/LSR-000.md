# LSR 000 - Lamina 核心语法规范

## 基本信息

- **LSR 编号**: 000
- **标题**: Lamina 核心语法规范  
- **作者**: Ziyang-Bai  
- **状态**: 应用（部分）
- **类型**: 标准规范  
- **创建日期**: 09-13-2025  
- **Lamina 版本**: 全部  

## 摘要

本 LSR 定义 Lamina 编程语言核心语法，包括数据类型、运算符、语句结构、精确数学行为及错误处理。任何 Lamina 实现必须遵守本规范以保证语言一致性和可移植性。

---

## 技术规范

### 1. 数据类型与语义

#### 1.1 基本类型

| 类型         | 描述 | 示例 |
| ------------ | ---- | ---- |
| `int`        | 整数，任意精度 | `42`, `-10`, `1000000000000000000000` |
| `float`      | 浮点数 | `3.14`, `-0.5` |
| `rational`   | 精确分数 | `16/9`, `1/3` |
| `irrational` | 精确无理数 | `√2`, `π`, `e` |
| `bool`       | 布尔值 | `true`, `false` |
| `string`     | 字符串 | `"Hello"` |
| `null`       | 空值 | `null` |

**行为规范**:  
- `rational` 自动约分，算术保持精确  
- `irrational` 符号化表示，不近似  
- `int` 支持任意精度  

#### 1.2 复合类型

- **数组**: `[1, 2, 3]`  
- **矩阵**: `[[1,2],[3,4]]`  
- **函数**: `func add(a,b){ return a+b; }`  

---

### 2. 语句与控制结构

#### 2.1 语句终止符

- 所有语句必须以分号 `;` 结束  

#### 2.2 控制语句

- 条件语句: `if (cond) { ... } else { ... }`  
- 循环语句: `while (cond) { ... }`, `for (var i=0;i<n;i++){...}`  
- 跳转语句: `break;`, `continue;`, `return expr;`  

#### 2.3 模块引入

```lamina
include "filename";
```
- 仅支持当前目录
- 文件名必须使用引号，自动添加 .lm 扩展名

### 3. 关键字和注释

#### 3.1 关键字

```
var, func, if, else, while, for, return, break, continue,
print, true, false, null, input, assert
```

#### 3.2 注释

- 单行：`// 注释`
- 多行：`/* 注释块 */`

### 4.运算符与优先级

| 优先级 | 运算符         | 描述    |    |     |
| --- | ----------- | ----- | -- | --- |
| 1   | `!`         | 阶乘    |    |     |
| 2   | `^`         | 幂     |    |     |
| 3   | `* / %`     | 乘、除、模 |    |     |
| 4   | `+ -`       | 加、减   |    |     |
| 5   | `== !=`     | 相等/不等 |    |     |
| 6   | `< <= > >=` | 比较    |    |     |
| 7   | `&&`        | 逻辑与   |    |     |
| 8   | \`          |       | \` | 逻辑或 |

- 向量/矩阵运算: `+ - * dot(v1,v2) cross(v1,v2)`
- 所有运算符遵循左结合性，除 `^` 右结合

### 5. 精确数学行为

- **有理数**: 自动约分，所有算术保持精确

- **无理数**: 符号化表示，不近似

- **整数**: 任意精度

- **示例**

```
var r = 1/10 + 2/10; // 精确 3/10
var root = sqrt(8);   // 自动化简为 2√2
var big = 1000000000000000; // 任意精度整数
```

### 6. 错误处理与栈追踪

- 异常类型: `RuntimeError`, `TypeError`, `IndexError`, `KeyError`

- 栈追踪: 必须提供文件名、行号、调用链
```
Traceback (most recent call last):
  File "script.lm", line 12, in level1
RuntimeError: Undefined variable 'unknown_variable'
```